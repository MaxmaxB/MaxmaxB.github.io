<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoppr TV - Transform Your TV Advertising</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            background-color: #1a1a1a;
        }

        #remoteCursor {
            position: fixed;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 999999;
            transform: translate(0, 0);
            transition: none;
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.8));
        }

        #remoteCursor svg {
            width: 100%;
            height: 100%;
        }

        #counterDisplay {
            position: fixed;
            top: 10px;
            right: 10px;
            background: black;
            color: white;
            padding: 10px 20px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 5px;
            z-index: 999998;
            font-family: Arial, sans-serif;
        }

        iframe {
            width: 100%;
            height: auto;
            min-height: 100vh;
            border: none;
            background-color: #1a1a1a;
            display: block;
        }
    </style>
</head>

<body>
    <iframe id="adFrame" frameborder="0" marginheight="0" marginwidth="0" tabindex="-1" scrolling="yes"></iframe>
    <div id="counterDisplay">12</div>

    <script>
        const iframe = document.getElementById("adFrame");

        // Check if QjyScript is available, otherwise create a mock for testing
        let coolitaBrowserExtend;
        if (typeof QjyScript !== 'undefined') {
            coolitaBrowserExtend = new QjyScript();
            console.log('QjyScript initialized - TV remote mode');
        } else {
            // Mock QjyScript for browser testing
            coolitaBrowserExtend = {
                exec: function (command, ...args) {
                    console.log('QjyScript Mock:', command, args);
                }
            };
            console.log('QjyScript not available - using mock for browser testing');
        }

        // Create visible cursor element with embedded SVG
        const cursor = document.createElement('div');
        cursor.id = 'remoteCursor';
        cursor.innerHTML = `
            <svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" version="1.1">
                <path style="stroke:#111;stroke-width:4;fill:#ddd;" d="M 5,5 90,30 65,50 95,80 80,95 50,65 30,90 z"/>
            </svg>
        `;
        document.body.appendChild(cursor);

        // Cursor state
        const cursorState = {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            speed: 5
        };

        // Track which keys are currently pressed
        const keysPressed = {
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false
        };

        // Update cursor position (both visible and virtual)
        function updateCursorPosition(x, y) {
            // Apply boundary checking
            cursorState.x = Math.max(0, Math.min(window.innerWidth, x));
            cursorState.y = Math.max(0, Math.min(window.innerHeight, y));

            // Update visible cursor (SVG cursor positioned from top-left at 5,5 in viewBox)
            cursor.style.left = cursorState.x + 'px';
            cursor.style.top = cursorState.y + 'px';

            // Update QjyScript virtual mouse position (use tip of cursor)
            coolitaBrowserExtend.exec("qjy_SetMousePos", "" + Math.round(cursorState.x), "" + Math.round(cursorState.y));
        }

        // Initialize cursor at bottom-center of screen
        updateCursorPosition(cursorState.x, cursorState.y);

        // Scroll amount in pixels
        const scrollAmount = 50;

        // Comprehensive QjyScript scroll simulation function
        function qjyScrollPage(amount) {
            // Try multiple QjyScript methods to simulate scrolling

            // Method 1: Direct scroll by amount
            try {
                coolitaBrowserExtend.exec("qjy_ScrollBy", "0", amount.toString());
            } catch (e) {
                console.log('qjy_ScrollBy failed:', e);
            }

            // Method 2: Alternative direct scroll command
            try {
                coolitaBrowserExtend.exec("qjy_Scroll", "0", amount.toString());
            } catch (e) {
                console.log('qjy_Scroll failed:', e);
            }

            // Method 3: Mouse wheel simulation
            try {
                coolitaBrowserExtend.exec("qjy_SimulateWheel", amount.toString());
            } catch (e) {
                console.log('qjy_SimulateWheel failed:', e);
            }

            // Method 4: Alternative mouse wheel
            try {
                coolitaBrowserExtend.exec("qjy_MouseWheel", "0", amount.toString());
            } catch (e) {
                console.log('qjy_MouseWheel failed:', e);
            }

            // Method 5: Keyboard simulation (PageDown/PageUp)
            try {
                const key = amount > 0 ? "PageDown" : "PageUp";
                coolitaBrowserExtend.exec("qjy_SimulateKey", key);
            } catch (e) {
                console.log('qjy_SimulateKey failed:', e);
            }

            // Method 6: Window-specific scroll
            try {
                coolitaBrowserExtend.exec("qjy_ScrollWindow", "0", amount.toString());
            } catch (e) {
                console.log('qjy_ScrollWindow failed:', e);
            }

            // Method 7: Set scroll position (get current + add amount)
            try {
                const newScrollY = window.scrollY + amount;
                coolitaBrowserExtend.exec("qjy_SetScrollPos", "0", newScrollY.toString());
            } catch (e) {
                console.log('qjy_SetScrollPos failed:', e);
            }

            // Method 8: Alternative scroll position setting
            try {
                const newScrollY = window.scrollY + amount;
                coolitaBrowserExtend.exec("qjy_SetScrollPosition", "0", newScrollY.toString());
            } catch (e) {
                console.log('qjy_SetScrollPosition failed:', e);
            }

            // Method 9: Execute JavaScript directly
            try {
                coolitaBrowserExtend.exec("qjy_ExecuteJS", `window.scrollBy(0, ${amount})`);
            } catch (e) {
                console.log('qjy_ExecuteJS failed:', e);
            }

            // Method 10: Alternative JS execution
            try {
                coolitaBrowserExtend.exec("qjy_Eval", `window.scrollBy(0, ${amount})`);
            } catch (e) {
                console.log('qjy_Eval failed:', e);
            }

            // Method 11: Touch gesture simulation (swipe)
            try {
                const direction = amount > 0 ? "up" : "down";
                coolitaBrowserExtend.exec("qjy_SimulateSwipe", direction, Math.abs(amount).toString());
            } catch (e) {
                console.log('qjy_SimulateSwipe failed:', e);
            }

            // Method 12: Touch event simulation
            try {
                const startY = window.innerHeight / 2;
                const endY = startY - amount;
                coolitaBrowserExtend.exec("qjy_SimulateTouch", "drag", "0", startY.toString(), "0", endY.toString());
            } catch (e) {
                console.log('qjy_SimulateTouch failed:', e);
            }

            // Method 13: Scroll element by ID/selector
            try {
                coolitaBrowserExtend.exec("qjy_ScrollElement", "body", "0", amount.toString());
            } catch (e) {
                console.log('qjy_ScrollElement body failed:', e);
            }

            // Method 14: Scroll html element
            try {
                coolitaBrowserExtend.exec("qjy_ScrollElement", "html", "0", amount.toString());
            } catch (e) {
                console.log('qjy_ScrollElement html failed:', e);
            }

            // Method 15: Trigger scroll event manually
            try {
                coolitaBrowserExtend.exec("qjy_TriggerEvent", "scroll", amount.toString());
            } catch (e) {
                console.log('qjy_TriggerEvent failed:', e);
            }

            // Method 16: Dispatch wheel event
            try {
                coolitaBrowserExtend.exec("qjy_DispatchEvent", "wheel", `{"deltaY": ${amount}}`);
            } catch (e) {
                console.log('qjy_DispatchEvent failed:', e);
            }

            // Method 17: Simulate arrow key multiple times
            try {
                const key = amount > 0 ? "ArrowDown" : "ArrowUp";
                const times = Math.floor(Math.abs(amount) / 10);
                for (let i = 0; i < times; i++) {
                    coolitaBrowserExtend.exec("qjy_SimulateKey", key);
                }
            } catch (e) {
                console.log('qjy_SimulateKey ArrowDown/Up failed:', e);
            }

            // Method 18: Direct scroll command with y parameter
            try {
                coolitaBrowserExtend.exec("qjy_Scroll", "y", amount.toString());
            } catch (e) {
                console.log('qjy_Scroll y failed:', e);
            }

            // Method 19: Scroll with animation flag
            try {
                coolitaBrowserExtend.exec("qjy_ScrollBy", "0", amount.toString(), "smooth");
            } catch (e) {
                console.log('qjy_ScrollBy smooth failed:', e);
            }

            // Method 20: Execute window.scroll with current position
            try {
                const newScrollY = window.scrollY + amount;
                coolitaBrowserExtend.exec("qjy_ExecuteJS", `window.scroll(0, ${newScrollY})`);
            } catch (e) {
                console.log('qjy_ExecuteJS scroll failed:', e);
            }
        }

        // Animation loop for continuous movement
        function animateCursor() {
            let moved = false;
            const bottomThreshold = 10; // Pixels from bottom to trigger scroll
            const topThreshold = 0; // Pixels from top to trigger scroll

            if (keysPressed.ArrowUp) {
                // Check if cursor is at the top of the screen
                if (cursorState.y <= topThreshold) {
                    // Scroll main page up
                    qjyScrollPage(-scrollAmount);
                } else {
                    cursorState.y -= cursorState.speed;
                    moved = true;
                }
            }
            if (keysPressed.ArrowDown) {
                // Check if cursor is at the bottom of the screen
                if (cursorState.y >= window.innerHeight - bottomThreshold) {
                    // Scroll main page down
                    qjyScrollPage(scrollAmount);
                } else {
                    cursorState.y += cursorState.speed;
                    moved = true;
                }
            }
            if (keysPressed.ArrowLeft) {
                cursorState.x -= cursorState.speed;
                moved = true;
            }
            if (keysPressed.ArrowRight) {
                cursorState.x += cursorState.speed;
                moved = true;
            }

            if (moved) {
                updateCursorPosition(cursorState.x, cursorState.y);
            }

            requestAnimationFrame(animateCursor);
        }

        // Start animation loop
        animateCursor();

        // Handle key down events
        document.addEventListener('keydown', (event) => {
            const keyName = event.key;
            const counterDisplay = document.getElementById('counterDisplay');
            counterDisplay.innerHTML += '<br>' + keyName;

            // Handle backspace
            if (keyName === "Backspace") {
                event.preventDefault();
                window.history.back();
                return;
            }

            if (keyName === "Home") {
                event.preventDefault();
                // window.history.go(-window.history.length);
                window.close();
                return;
            }

            // Handle Enter key for clicking
            if (keyName === "Enter") {
                event.preventDefault();
                coolitaBrowserExtend.exec("qjy_SimulateClick");
                return;
            }

            // Handle arrow keys
            if (keyName in keysPressed) {
                event.preventDefault();
                keysPressed[keyName] = true;
            }
        });

        // Handle key up events
        document.addEventListener('keyup', (event) => {
            const keyName = event.key;

            if (keyName in keysPressed) {
                event.preventDefault();
                keysPressed[keyName] = false;
            }
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            updateCursorPosition(cursorState.x, cursorState.y);
        });

        // Prevent iframe from stealing focus
        iframe.addEventListener('focus', () => {
            window.focus();
            document.body.focus();
        });

        // Also monitor for focus changes and ensure parent window stays focused
        window.addEventListener('blur', () => {
            setTimeout(() => {
                window.focus();
            }, 0);
        });

        // Use a test URL that allows iframe embedding
        // When deploying to TV, replace this with the actual RAC URL
        // iframe.src = "advertisement.html"  // Local test page
        iframe.src = "https://workshops.granta.com/"
        // iframe.src = "https://rac.com.au/products/insurance?utm_content=&gclsrc=aw.ds&gad_source=1&gad_campaignid=23027471472&gbraid=0AAAAADnUn4xZy7RTLOzUun_fmDG8iGooN&gclid=Cj0KCQiAq7HIBhDoARIsAOATDxCl6UoH4UbZp1VehexS2eBJzqHc0cj-3NrwcdM6KZB-oN0lI6mtfkIaAsB1EALw_wcB"
    </script>
</body>

</html>